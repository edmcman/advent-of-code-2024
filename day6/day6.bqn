in â† >â€¢file.Lines "input.txt"

FindStartIndex â† âŠ‘âˆ˜/â—‹â¥ŠâŸœ(â†•â‰¢)â‰¡Â¨âŸœ'^'

dirs â† 'U'â€¿'R'â€¿'D'â€¿'L'
deltas â† (Â¯1â€¿0)â€¿(0â€¿1)â€¿(1â€¿0)â€¿(0â€¿Â¯1)
MkState â† {
    dirâ‡0
    
    gridâ‡ğ•©
    coordâ‡FindStartIndex ğ•©
    GetDirDelta â‡ {ğ•¤
        dir âŠ‘ deltas
    }
    #HasObstacle â‡ { '#'=ğ•©âŠ‘grid }
    OnGrid â‡ âˆ§Â´(â‰¥âŸœ0)âˆ¾<âŸœ(â‰¢grid)
    HasObstacleHuh â‡ {ğ•¤â‹„'#'=âŠ‘âŸœgrid}
    HasObstacle â‡ {ğ•¤
        '#'=ğ•©âŠ‘grid
    }
    Turn â‡ {ğ•¤
        dir â†© 4|dir+1
    }

    Step â‡ {ğ•¤
        grid â†© 'X'âŒ¾(coordâŠ¸ âŠ‘) grid
        newcoord â† coord + GetDirDelta dir
        {OnGrid newcoord ?
        {
            HasObstacle newcoord ?
            # Can't move in current direction, try turning.
            Turn @;
            # Otherwise move
            coord â†© newcoord
        };
        # Move off the grid.
        coord â†© newcoord}
    }
    SetGrid â‡ {ğ•¤â‹„grid â†© ğ•©}
}

While â† {ğ•©â€¢_while_ğ•¨@}Â´

Part1 â† {ğ•¤
    state â† MkState ğ•©

    While {ğ•¤â‹„state.OnGrid state.coord}â€¿{ğ•¤
        state.Step @
        #â€¢Show state.coord
    }

    count â† +Â´â¥Š'X'=state.grid
}

IsCycle â† {ğ•Š:
    state â† ğ•©
    seen â† âŸ¨âŸ©
    GetSt â† {ğ•Š: â‹ˆ (state.dirâ‹ˆstate.coord)}
    While {ğ•¤â‹„(state.OnGrid state.coord) âˆ§ âŠ‘Â¬(<GetSt@)âˆŠseen}â€¿{ğ•¤
        #â€¢Show state.coord
        ! âŠ‘Â¬(<GetSt@)âˆŠseen
        seen â†© seenâˆ¾<GetSt@
        ! (â‰ seen) < 100000
        ! âŠ‘(<GetSt@)âˆŠseen
        state.Step @
        #â€¢Show state.grid
        #â€¢Show â‰ seen

    }
    âŠ‘(<GetSt@)âˆŠseen
}

Indices â† /â—‹â¥ŠâŸœ(â†•â‰¢)

Part2 â† {ğ•Š:
    in â† ğ•©
    state â† MkState ğ•©
    possibles â† Indices ('#'âŠ¸â‰ âˆ§ '^'âŠ¸â‰ ) state.grid

    # only test the states in the original path!

    TestCoord â† {ğ•¤
        state â† MkState in
        state.SetGrid '#'âŒ¾(ğ•©âŠ¸ âŠ‘) state.grid
        #â€¢Show state.grid
        #â€¢Show ğ•©
        IsCycle state
    }

    #TestCoord 6â€¿3
    +Â´ TestCoordÂ¨ possibles
    #42
    #IsCycle MkState ğ•©
}

#â€¢Show Part1 in
â€¢Show Part2 in

