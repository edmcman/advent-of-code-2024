in â† '0'-ËœâŠ‘â€¢file.Lines "input.txt"

blockends â† +` in
blockstarts â† 0âˆ¾Â¯1â†“blockends


filesâ€¿frees â†  ((âŠâŠ¢)â‹ˆ(Â¯1â†“1âŠâŠ¢)) (â‰(âˆ˜â€¿2 â¥Š inâˆ¾Â¯1))

mat â† âˆ˜â€¿2 â¥Š inâˆ¾0

# first column is block #
# second column is block size
# third column is free size
matplusplus â† â‰(1â€¿(â‰ mat)â¥Š(â†•â‰ mat))âˆ¾â‰mat

#freespaces â† +Â´ 2âŠâ‰matplusplus

# Now we need to know the last freespaces blocks.

Repeat â† {ğ•¨/[ğ•©]}

#â€¢Show matplusplus
string â† âˆ¾Â´ {<((1âŠ‘ğ•©) Repeat âŠ‘ğ•©) âˆ¾ ((2âŠ‘ğ•©) Repeat '.')}Ë˜ matplusplus

#â€¢Show string

# 3 GetLastData string
GetLastData â† âŒ½-âŠ¸â†‘âŸœ('.'âŠ¸â‰ âŠ¸/)

part1 â† {
    numfree â† +Â´ string = '.'
    compressed â† (-numfree) â†“ (numfree GetLastData string)âŒ¾((string='.')âŠ¸/) string
    +Â´ (âŠ£Ã—(â†•â‰ )) compressed
}

â€¢Show part1

stringp2 â† âˆ¾Â´ {<((1âŠ‘ğ•©) Repeat âŠ‘ğ•©) âˆ¾ ((2âŠ‘ğ•©) Repeat -(1+âŠ‘ğ•©))}Ë˜ matplusplus

ReplaceNegWithNegOne â† {Â¯1Â¨âŒ¾((ğ•©<0)âŠ¸/) ğ•©}

# ğ•¨: the string
# ğ•©: number to attempt to move
MoveItP2 â† {ğ•Š:
    thingtomove â† ğ•©âŠ‘âŠ”ËœReplaceNegWithNegOne ğ•¨
    #â€¢Show "thingtomove" â‹ˆ thingtomove
    size â† â‰ thingtomove

    #test â†  ReplaceNegWithNegOne (-stringp2 + 1)
    #â€¢Show "test" â‹ˆ test

    oldindex â† âŠ‘/(ğ•¨=ğ•©)
    #â€¢Show "oldindex" â‹ˆ oldindex
    leftstring â† oldindexâ†‘ğ•¨
    #â€¢Show "leftstring" â‹ˆ leftstring

    freegroups â† âŠ”Ëœ ReplaceNegWithNegOne (-leftstring + 1)
    freegroupsizes â† â‰ Â¨ freegroups
    #â€¢Show "freegroups" â‹ˆ freegroups

    # big enough groups
    #â€¢Show (<size)â‰¤freegroupsizes
    bigenough â† / (<size)â‰¤freegroupsizes

    #â€¢Show bigenough

    ğ•¨ {
        (â‰ bigenough) > 0 ?
        destgroupnum â† -1+âŠ‘bigenough
    
        #â€¢Show "move to free group" â‹ˆ destgroupnum

        # move
        moved â† {thingtomoveâŒ¾(sizeâ†‘((ğ•©=destgroupnum)âŠ¸/)) ğ•©} ğ•¨

        # free the old location
        # XXX change me
        newfreegrp â† -1+â‰ freegroupsizes
        newfreegrpÂ¨âŒ¾((ğ•¨=ğ•©)âŠ¸/) moved
        
        ;
        #â€¢Show "no move"
        ğ•¨
    } ğ•©
}

#â€¢Show stringp2 MoveItP2 1

part2 â† {
    compressed â† stringp2 MoveItP2ËœÂ´ (â· {ğ•©â‰¥0}âŠ¸/ stringp2)
    +Â´ (âŠ£Ã—(â†•â‰ )) {0Â¨âŒ¾((ğ•©<0)âŠ¸/) ğ•©} compressed
}

â€¢Show part2